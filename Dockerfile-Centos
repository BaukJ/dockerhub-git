ARG VERSION=1.8.2.3
ARG REPO_BASE=https://www.kernel.org/pub/software/scm/git/



##### Compile git in a bloated container
FROM bauk/git:centos-build-base as build
ARG REPO_BASE
ARG VERSION
RUN wget $REPO_BASE/git-${VERSION}.tar.gz
RUN tar xzf git-${VERSION}.tar.gz

WORKDIR /build/git-${VERSION}
RUN autoconf
RUN ./configure
RUN make
RUN make man
RUN make install
RUN make install-man



##### Final small image, just copying everything needed from install
FROM bauk/git:centos-base
COPY ./entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh
ENTRYPOINT ["/entrypoint.sh"]
WORKDIR /git

COPY --from=build /usr/local /usr/local

